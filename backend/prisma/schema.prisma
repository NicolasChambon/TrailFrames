// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum SportType {
  AlpineSki
  BackcountrySki
  Badminton
  Canoeing
  Crossfit
  EBikeRide
  Elliptical
  EMountainBikeRide
  Golf
  GravelRide
  Handcycle
  HighIntensityIntervalTraining
  Hike
  IceSkate
  InlineSkate
  Kayaking
  Kitesurf
  MountainBikeRide
  NordicSki
  Pickleball
  Pilates
  Racquetball
  Ride
  RockClimbing
  RollerSki
  Rowing
  Run
  Sail
  Skateboard
  Snowboard
  Snowshoe
  Soccer
  Squash
  StairStepper
  StandUpPaddling
  Surfing
  Swim
  TableTennis
  Tennis
  TrailRun
  Velomobile
  VirtualRide
  VirtualRow
  VirtualRun
  Walk
  WeightTraining
  Wheelchair
  Windsurf
  Workout
  Yoga
}

enum Sex {
  M
  F
  O
}

model User {
  id                    String      @id @default(cuid())
  email                 String      @unique
  stravaAthleteId       BigInt?     @unique
  username              String?
  lastName              String?
  firstName             String?
  refreshTokens         RefreshToken[]
  stravaAccessToken     String?                          // Encrypted with AES-256-GCM
  stravaRefreshToken    String?                          // Encrypted with AES-256-GCM       
  stravaTokenExpiresAt  DateTime?
  password              String
  activities            Activity[]
  bio                   String?
  city                  String?
  state                 String?
  country               String?
  sex                   Sex?
  weight                Float?
  profileMedium         String?
  profile               String?
  friend                Int?
  follower              Int?
  badgeTypeId           Int?
  premium               Boolean?
  summit                Boolean?
  stravaCreatedAt       DateTime?
  stravaUpdatedAt       DateTime?
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt

  @@index([stravaAthleteId])
}

model RefreshToken {
  id         String   @id @default(cuid())
  token      String   @unique
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt  DateTime
  createdAt  DateTime @default(now())
}

model Activity {
  id                    String    @id @default(cuid())
  stravaActivityId      BigInt    @unique
  trailFramesUserId     String
  user                  User      @relation(fields: [trailFramesUserId], references: [id])
  stravaAthleteId       BigInt
  name                  String
  distance              Float
  movingTime            Int
  elapsedTime           Int
  totalElevationGain    Float
  elevHigh              Float?
  elevLow               Float?
  sportType             SportType
  stravaUploadId        BigInt?
  startDate             DateTime
  startDateLocal        DateTime
  timezone              String
  startLatlng           Float[]
  endLatlng             Float[]
  achievementCount      Int
  kudosCount            Int
  commentCount          Int
  athleteCount          Int
  totalPhotoCount       Int
  summaryPolyline       String?
  trainer               Boolean
  commute               Boolean
  manual                Boolean
  private               Boolean
  flagged               Boolean
  workoutType           Int?
  averageSpeed          Float
  maxSpeed              Float
  hasKudoed             Boolean
  gearId                String?
  kilojoules            Float?
  averageWatts          Int?
  deviceWatts           Boolean?
  maxWatts              Int?
  weightedAverageWatts  Int?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([trailFramesUserId])
  @@index([startDate])
  @@index([sportType])
}
 
